/// Fastjet includes
#include <fastjet/ClusterSequence.hh>
#include <fastjet/Selector.hh>
#include <fastjet/contrib/SoftDrop.hh>
#include <fastjet/PseudoJet.hh>

/// Root includes
#include <TFile.h>
#include <TTree.h>
#include <TSystem.h>
#include <TRint.h>
#include <TROOT.h>
#include <TH1.h>
#include <TH2.h>
#include <TGraph.h>

/// EIC smear includes
#include <eicsmear/erhic/EventPythia.h>
#include <eicsmear/smear/EventS.h>

/// Local includes
#include "TruthEvent.h"
#include "SmearedEvent.h"
#include "JetDef.h"
#include "SoftDropJetDef.h"

#include <iostream>
#include <vector>

using PseudoJetVec = std::vector<fastjet::PseudoJet>;
using TLorentzVectorVec = std::vector<TLorentzVector>;
using TLorentzPair = std::pair<TLorentzVector, TLorentzVector>;
using TLorentzPairVec = std::vector<TLorentzPair>;
/// A JetConstPair is a pair of a jet 4 vector and vector of jet constituents
using JetConstPair = std::pair<TLorentzVector, std::vector<TLorentzVector>>;
using JetConstVec = std::vector<JetConstPair>;

TGraph* fillTruthMaps(erhic::EventPythia* event, TH2F *hist, int breit);
TGraph* fillRecoMaps(Smear::Event* event, TH2F *hist);

void setupJetTree(TTree *tree);
double checkPhi(double phi);

JetConstVec convertToTLorentzVectors(PseudoJetVec pseudoJets, bool SDJet);
std::vector<std::vector<JetConstPair>> convertMatchedJetVec(std::vector<PseudoJetVec> vec, bool SDJet);

/// Note - for SDJets, the first two entries in the constituent vector, i.e.
/// first two entries in the second of the pair list are the two subjets
JetConstVec truthR1Jets, recoR1Jets, recoR1SDJets, truthR1SDJets;
double truex, truey, trueq2, truenu;
double recx, recy, recq2, recnu;
TLorentzVector exchangeBoson, smearExchangeBoson;

/// This structure is a vector of vector of matched truth-reco jets. 
/// Each entry of std::vector<JetConstPair> is length 2 - first the truth
/// jet, then the reco jet
std::vector<std::vector<JetConstPair>> matchedR1Jets, matchedR1SDJets;
TLorentzPairVec matchedParticles;
fastjet::ClusterSequence *cs, *truthcs;
TH2 *eventhist;
TTree *jetTree;
int processId = 0;


int events[1000] = {
30,59,74,108,111,193,200,202,246,273,281,312,319,323,375,465,486,488,490,526,616,664,710,750,764,772,781,850,931,955,990,999,1001,1004,1020,1031,1074,1119,1150,1174,1243,1374,1412,1453,1586,1605,1624,1663,1723,1758,1919,1930,1957,2048,2050,2099,2111,2128,2141,2172,2208,2218,2236,2259,2282,2303,2429,2431,2434,2440,2520,2557,2565,2596,2598,2615,2618,2628,2662,2712,2753,2762,2776,2788,2841,2862,2905,2960,2977,3032,3194,3212,3238,3369,3384,3387,3456,3536,3547,3564,3573,3577,3615,3646,3743,3762,3841,3855,3976,4003,4015,4025,4034,4055,4122,4194,4202,4209,4254,4313,4337,4382,4395,4448,4454,4463,4514,4548,4571,4573,4581,4670,4682,4692,4694,4697,4704,4743,4759,4762,4773,4794,4818,4864,4869,4875,4882,4994,5054,5056,5150,5202,5272,5369,5424,5433,5487,5501,5578,5595,5645,5655,5672,5673,5699,5773,5868,5898,5910,5937,5940,5946,5971,6027,6057,6099,6234,6248,6269,6289,6301,6308,6312,6323,6350,6360,6379,6472,6483,6633,6646,6689,6699,6706,6717,6729,6741,6775,6778,6789,6823,6835,6874,6880,6919,7064,7065,7071,7141,7189,7259,7283,7342,7382,7383,7432,7453,7496,7500,7508,7528,7573,7577,7587,7591,7664,7666,7765,7807,7842,7865,7895,7909,7943,7988,8023,8073,8165,8195,8249,8264,8288,8324,8337,8341,8342,8367,8373,8384,8402,8404,8423,8424,8434,8478,8486,8581,8629,8769,8783,8792,8871,8940,8989,9026,9069,9106,9145,9151,9173,9227,9239,9257,9266,9316,9389,9410,9478,9490,9517,9519,9540,9566,9577,9601,9614,9669,9732,9737,9738,9799,9844,9852,9853,9858,9910,9953,9982,10011,10037,10100,10112,10213,10272,10276,10288,10294,10320,10351,10359,10476,10500,10567,10599,10709,10721,10766,10785,10800,10809,10813,10827,10831,10873,10877,10879,10889,10894,10929,10955,10963,10970,10983,10988,11011,11031,11047,11060,11066,11081,11195,11237,11252,11276,11341,11399,11448,11496,11522,11530,11615,11643,11646,11662,11701,11753,11758,11766,11774,11846,11932,12012,12058,12075,12089,12090,12096,12099,12101,12122,12153,12200,12284,12303,12357,12379,12430,12434,12468,12506,12516,12530,12532,12542,12560,12569,12572,12616,12662,12687,12688,12865,12944,12979,12992,13060,13117,13122,13139,13211,13216,13219,13221,13269,13271,13282,13293,13353,13438,13486,13581,13603,13633,13635,13663,13723,13811,13813,13861,13862,13913,13951,13956,14013,14018,14035,14116,14156,14172,14254,14286,14323,14394,14397,14416,14438,14530,14603,14624,14638,14645,14670,14683,14690,14706,14753,14766,14786,14852,14905,14906,14910,14963,15007,15076,15086,15101,15122,15194,15211,15229,15234,15245,15280,15283,15301,15355,15377,15480,15485,15572,15644,15660,15679,15714,15748,15789,15823,15828,15849,15901,15952,15959,16003,16026,16112,16122,16146,16150,16225,16232,16298,16323,16360,16406,16503,16504,16513,16530,16576,16577,16580,16593,16613,16696,16754,16791,16792,16820,16866,16890,16963,17054,17067,17088,17134,17137,17144,17221,17302,17308,17310,17337,17347,17359,17439,17455,17488,17533,17542,17560,17566,17605,17606,17624,17636,17713,17720,17734,17749,17844,17905,18083,18112,18180,18191,18225,18261,18266,18267,18279,18400,18434,18439,18441,18488,18514,18606,18624,18634,18654,18661,18683,18695,18756,18783,18791,18825,18841,18908,18961,18981,19034,19035,19040,19077,19078,19082,19095,19099,19130,19209,19234,19242,19384,19388,19470,19509,19524,19557,19631,19671,19678,19713,19771,19783,19800,19805,19819,19905,19933,19938,19966,19986,20017,20047,20054,20098,20159,20189,20326,20412,20423,20426,20458,20472,20474,20512,20530,20542,20565,20616,20669,20704,20757,20843,20851,20875,20898,20927,20998,21014,21015,21036,21047,21116,21142,21145,21170,21193,21213,21232,21280,21387,21393,21460,21514,21541,21574,21595,21598,21600,21605,21617,21635,21650,21681,21688,21699,21723,21749,21787,21798,21799,21819,21821,21873,21927,22007,22110,22113,22120,22160,22297,22311,22354,22373,22416,22424,22463,22558,22571,22573,22652,22687,22755,22803,22807,22890,22893,22913,22958,22975,22989,22992,23033,23143,23230,23241,23258,23260,23263,23321,23350,23419,23454,23512,23549,23609,23627,23681,23764,23768,23797,23827,23841,23856,23922,23932,24042,24103,24109,24240,24241,24255,24319,24328,24334,24396,24407,24416,24432,24461,24468,24506,24541,24563,24578,24580,24625,24691,24713,24719,24768,24797,24936,24957,25047,25092,25198,25287,25324,25350,25383,25398,25419,25482,25485,25504,25510,25523,25533,25539,25583,25682,25747,25781,25807,25809,25812,25839,25947,25954,26078,26089,26134,26170,26217,26253,26273,26282,26284,26386,26398,26416,26421,26433,26459,26466,26485,26496,26519,26609,26634,26639,26733,26746,26775,26790,26806,26830,26915,26921,26956,27004,27031,27060,27067,27086,27106,27134,27138,27139,27185,27186,27248,27274,27298,27426,27433,27468,27505,27539,27559,27577,27618,27644,27771,27832,27839,27863,27865,27883,27896,27919,28017,28029,28095,28122,28143,28180,28212,28277,28280,28319,28373,28392,28413,28447,28459,28466,28471,28497,28588,28656,28658,28760,28766,28771,28825,28889,28900,28920,28945,28984,29006,29021,29040,29135,29173,29178,29189,29214,29238,29285,29289,29293,29318,29332,29335,29441,29547,29564,29572,29605,29620,29695,29732,29753,29795,29947,29981,30010,30026,30034,30038,30140,30197,30272,30386,30422,30423,30432,30496,30499,30531,30631,30684,30715,30806,30841,30848,30851,30881,30884,30891,30916,30917,30931,31005,31008,31060,31099,31165,31180,31214,31225,31233,31276,31289,31317,31323,31335,31340,31347,31350,31368,31379,31440,31454,31517,31570,31573,31586,31593,31680,31732,31770,31839,31868,31888,31915,31987,31990,32004,32013,32132,32172,32205,32300,32305,32424,32442,32479,32500,32590,32601,32620,32651,32706,32730,32737,32760,32762,32772,32775,32805,32868,32874,32882,32960,32990,32994,33047,33066,33176,33296,33317,33395,33404,33440,33446,33479,33488,33596,33722,33728,33738,33749,33868
};
